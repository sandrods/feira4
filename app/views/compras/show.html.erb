<%= page_header "Exibir Compra" do %>
  <%= link_to icon(:chevron_left, "Voltar"), compras_path, class: 'btn' %>
  <%= link_to icon(:edit, 'Editar Compra'), edit_compra_path(@compra), class: 'btn btn-sm btn-primary' %>
<% end %>

<div class="well well-sm show">

  <div class="row">

    <div class="col-sm-5 big">
      <%= @compra.fornecedor.nome %>
      <small><%= l @compra.data, format: :medium %></small>
    </div>

    <div class="col-sm-2 col-xs-4 big">
      <%= @compra.itens.count %> <small>peças</small>
    </div>

    <div class="col-sm-3 col-xs-4 big">
      <%= number_to_currency @compra.total %> <small>total</small>
    </div>

    <div class="col-sm-2 col-xs-4 big desconto">
      <%= number_to_percentage @compra.desconto %>
      <small><b>DESCONTO</b></small>
    </div>

  </div>

</div>

<div class="row">

  <div class="col-sm-7 col-md-7 col-lg-8">

    <div class="panel panel-info">
      <div class="panel-heading">
        <b class="panel-title">Peças</b>
        <input type='text' class="pull-right bar-code-input" placeholder="Código de Barras" maxlength="10" />
      </div>
      <table class="table table-condensed table-striped">
        <thead>
          <tr>
            <th>Cód.</th>
            <th>Produto</th>
            <th>Cor</th>
            <th>Tam.</th>
            <th class="text-right">Valor</th>
            <th>&nbsp;</th>
          </tr>               
        </thead>
        <tbody>
          <%- @compra.itens.each do |citem| -%>
          <tr>
            <td><small><%= citem.item.barcode %></small></td>
            <td><%= citem.item.produto.ref %></td>
            <td><small><%= citem.item.cor.try :nome %></small></td>
            <td><small><%= citem.item.tamanho.try :nome %></small></td>
            <td class="text-right"><%= number_to_currency citem.valor %></td>
            <td>&nbsp;</td>
          </tr>
          <% end -%>
        </tbody>
      </table>
    </div>

  </div>

  <div class="col-sm-5 col-md-5 col-lg-4">
    <div class="panel panel-danger">
      <div class="panel-heading">
        <b class="panel-title">Pagamentos</b>
        <%= button_tag icon(:plus, 'Incluir Pagamento'), class: 'btn btn-xs btn-default pull-right', id: 'add_pag' %>
        <%= button_tag icon(:chevron_up, 'Terminei de incluir'), class: 'btn btn-xs btn-default pull-right', id: 'end_add_pag', style: "display: none;"%>
      </div>

      <div class="panel-body" id='add_pag_form' style="display: none;">
        <%= simple_form_for [@compra, Registro.new], remote: true do |f| %>

          <div class="row">

            <div class="col-sm-5">
              <%= f.input :data %>
            </div>
            <div class="col-sm-7">
              <%= input_group(f, :valor, icon: :usd) %>
            </div>

          </div>

          <%= f.association :conta, label_method: :nome %>

          <div class="panel-actions pull-right">
            <%= f.submit 'Salvar', class: 'btn btn-xs btn-primary' %>
          </div>

        <% end -%>
      </div>

      <table class="table table-condensed table-striped">
        <thead>
          <tr>
            <th>Data.</th>
            <th class="text-right">Valor</th>
            <th>&nbsp;</th>
          </tr>               
        </thead>
        <tbody>
          <%- @compra.pagamentos.each do |pag| -%>
          <tr>
            <td><%= pag.data %></td>
            <td class="text-right"><%= number_to_currency pag.valor %></td>
            <td>&nbsp;</td>
          </tr>
          <% end -%>
        </tbody>
      </table>
    </div>
  </div>

</div>